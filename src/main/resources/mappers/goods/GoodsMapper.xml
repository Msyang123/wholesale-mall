<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lhiot.mall.wholesale.goods.mapper.GoodsMapper">
	<sql id="goodsColumn">
		t1.id,t1.goods_code as goodsCode,t1.goods_name as goodsName,t1.category_id as categoryId,
		t1.goods_image as goodsImage,t1.base_bar as baseBar,t1.base_unit as baseUnit,t1.stock_limit as stockLimit,
		t1.goods_des as goodsDes,t1.goods_images as goodsImages,t1.other_image as otherImage
	</sql>
	
	<sql id="unitColumn">
		t2.unit_code as baseUnitCode,t2.unit_name as baseUnitName
	</sql>
	
	<sql id="categoryColumn">
		t3.category_name as categoryName
	</sql>
	
	<!-- lynn 2018/4/19根据商品id查询商品 -->
	<select id="select" parameterType="Long" resultType="com.lhiot.mall.wholesale.goods.domain.Goods">
		select <include refid="goodsColumn"/>, <include refid="unitColumn"/>,<include refid="categoryColumn"/>
		from t_whs_goods t1
		left join t_whs_goods_unit t2 on t1.base_unit = t2.id
		left join t_whs_goods_category t3 on t1.category_id = t3.id
		where id = #{0}
	</select>
	
	<!-- lynn 2018/4/19根据商品id 新增商品 -->
	<insert id="insert" parameterType="com.lhiot.mall.wholesale.goods.domain.Goods">
		insert into t_whs_goods(
			<trim suffixOverrides=",">
				<if test="goodsCode != null and goodsCode != ''">goods_code,</if>
				<if test="goodsName != null and goodsName != ''">goods_name,</if>
				<if test="categoryId != null and categoryId != ''">category_id,</if>
				<if test="goodsImage != null and goodsImage != ''">goods_image,</if>
				<if test="baseBar != null and baseBar != ''">base_bar,</if>
				<if test="baseUnit != null and baseUnit != ''">base_unit,</if>
				<if test="stockLimit != null and stockLimit != ''">stock_limit,</if>
				<if test="goodsDes != null and goodsDes != ''">goods_des,</if>
				<if test="goodsImages != null and goodsImages != ''">goods_images,</if>
				<if test="otherImage != null and otherImage != ''">other_image,</if>
			</trim>
		)
		values(
			<trim suffixOverrides=",">
				<if test="goodsCode != null and goodsCode != ''">#{goodsCode},</if>
				<if test="goodsName != null and goodsName != ''">#{goodsName},</if>
				<if test="categoryId != null and categoryId != ''">#{categoryId},</if>
				<if test="goodsImage != null and goodsImage != ''">#{goodsImage},</if>
				<if test="baseBar != null and baseBar != ''">#{baseBar},</if>
				<if test="baseUnit != null and baseUnit != ''">#{baseUnit},</if>
				<if test="stockLimit != null and stockLimit != ''">#{stockLimit},</if>
				<if test="goodsDes != null and goodsDes != ''">#{goodsDes},</if>
				<if test="goodsImages != null and goodsImages != ''">#{goodsImages},</if>
				<if test="otherImage != null and otherImage != ''">#{otherImage},</if>
			</trim>
		)
	</insert>
	
	<!-- lynn 2018/4/19根据商品id 修改商品 -->
	<update id="update" parameterType="com.lhiot.mall.wholesale.goods.domain.Goods">
		update t_whs_goods
		<trim prefix="set" suffixOverrides=",">
			<if test="goodsCode != null and goodsCode != ''">goods_code=#{goodsCode},</if>
			<if test="goodsName != null and goodsName != ''">goods_name=#{goodsName},</if>
			<if test="categoryId != null and categoryId != ''">category_id=#{categoryId},</if>
			<if test="goodsImage != null and goodsImage != ''">goods_image=#{goodsImage},</if>
			<if test="baseBar != null and baseBar != ''">base_bar=#{baseBar},</if>
			<if test="baseUnit != null and baseUnit != ''">base_unit=#{baseUnit},</if>
			<if test="stockLimit != null and stockLimit != ''">stock_limit=#{stockLimit},</if>
			<if test="goodsDes != null and goodsDes != ''">goods_des=#{goodsDes},</if>
			<if test="goodsImages != null and goodsImages != ''">goods_images=#{goodsImages},</if>
			<if test="otherImage != null and otherImage != ''">other_image=#{otherImage},</if>
		</trim>
		where id = #{id}
	</update>
	
	<!-- lynn 2018/4/19根据商品id 删除商品 -->
	<delete id="removeInbatch" parameterType="java.util.List">
		delete from t_whs_goods where id in
		<foreach collection="list" item = "item" open="(" separator="," close=")">
			#{item}
		</foreach>
	</delete>
	
	<!-- lynn后台管理 分页查询2018/4/19 -->
	<select id="pageQueryCount" parameterType="com.lhiot.mall.wholesale.goods.domain.girdparam.GoodsGirdParam" resultType="Integer">
		select count(id) from t_whs_goods t1
		left join t_whs_goods_unit t2 on t1.base_unit = t2.id
		left join t_whs_goods_category t3 on t1.category_id = t3.id
		<trim prefix="where" prefixOverrides="and">
			<if test="goodsCode != null and goodsCode != ''">and goods_code=#{goodsCode}</if>
			<if test="goodsName != null and goodsName != ''">and goods_name like CONCAT('%',#{goodsName},'%')</if>
		</trim>
	</select>
	
	<!-- lynn后台管理 分页查询2018/4/19 -->
	<select id="pageQuery" parameterType="com.lhiot.mall.wholesale.goods.domain.girdparam.GoodsGirdParam" 
		resultType="com.lhiot.mall.wholesale.goods.domain.Goods">
		select <include refid="goodsColumn"/>, <include refid="unitColumn"/>,<include refid="categoryColumn"/>
		from t_whs_goods t1
		left join t_whs_goods_unit t2 on t1.base_unit = t2.id
		left join t_whs_goods_category t3 on t1.category_id = t3.id
		<trim prefix="where" prefixOverrides="and">
			<if test="goodsCode != null and goodsCode != ''">and goods_code=#{goodsCode}</if>
			<if test="goodsName != null and goodsName != ''">and goods_name like CONCAT('%',#{goodsName},'%')</if>
		</trim>
		<include refid="common.pager"></include>
	</select>


	<select id="goodsInfo" parameterType="long" resultType="com.lhiot.mall.wholesale.goods.domain.GoodsInfo">
		select g.id,g.goods_name,s.price,
		(select MAX(r.price) from t_whs_goods_price_region r where r.goods_standard_id=s.id ) maxPrice,
		(select MIN(r.price) from t_whs_goods_price_region r where r.goods_standard_id=s.id ) minPrice,
		u.unit_name,s.standard,g.stock_limit,g.goods_image,g.goods_des,g.goods_images,g.other_image, s.id goodsStandardId
		from t_whs_goods g
		left join t_whs_goods_standard s on g.id=s.goods_id
		left join t_whs_goods_unit u on u.unit_code=s.unit_code
		where g.id=#{id}
	</select>

	<select id="goodsFlashsale" parameterType="long" resultType="com.lhiot.mall.wholesale.goods.domain.GoodsFlashsale">
		select special_price,limit_quantity,end_time from t_whs_flashsale_goods where goods_standard_id=#{0}
	</select>

    <!-- 常用清单 -->
    <select id="inventoryList" parameterType="long" resultType="com.lhiot.mall.wholesale.goods.domain.GoodsInfo">
        select g.id,g.goods_name,s.price,(select MAX(price) FROM t_whs_goods_price_region r where r.goods_standard_id=s.id) maxPrice,
        (select MIN(price) from t_whs_goods_price_region r where r.goods_standard_id=s.id) minPrice,u.unit_name,f.special_price,
        (select count(*) from t_whs_order_goods og where og.goods_standard_id=s.id) saleCount,s.standard,g.goods_image
        from t_whs_goods_standard s
        LEFT JOIN t_whs_goods g on g.id=s.goods_id
        LEFT JOIN t_whs_goods_unit u on u.unit_code=s.unit_code
        LEFT JOIN t_whs_flashsale_goods f on f.goods_standard_id=s.id
        where s.id in(SELECT DISTINCT t.goods_standard_id FROM t_whs_order_goods t where t.user_id=#{0}) LIMIT 5
    </select>

    <!--<select id="" parameterType="long" resultType="com.lhiot.mall.wholesale.goods.domain.GoodsFlashsale">
        select special_price,limit_quantity,end_time from t_whs_flashsale_goods where goods_standard_id=#{0}
    </select>-->

    <!-- 常用清单 -->
    <select id="recommendList" parameterType="long" resultType="com.lhiot.mall.wholesale.goods.domain.GoodsInfo">
        select g.id,g.goods_name,s.price,(select MAX(price) FROM t_whs_goods_price_region r where r.goods_standard_id=s.id) maxPrice,
        (select MIN(price) from t_whs_goods_price_region r where r.goods_standard_id=s.id) minPrice,u.unit_name,f.special_price,
        (select count(*) from t_whs_order_goods og where og.goods_standard_id=s.id) saleCount,s.standard
        from t_whs_goods_standard s
        LEFT JOIN t_whs_goods g on g.id=s.goods_id
        LEFT JOIN t_whs_goods_unit u on u.unit_code=s.unit_code
        LEFT JOIN t_whs_flashsale_goods f on f.goods_standard_id=s.id
        where s.id in(SELECT DISTINCT t.goods_standard_id FROM t_whs_plate_goods t where t.plate_id=#{0}) LIMIT 5
    </select>

	<!-- 根据条件查询商品 -->
	<select id="searchByCategory" parameterType="java.util.List" 
		resultType="com.lhiot.mall.wholesale.goods.domain.Goods">
		select <include refid="goodsColumn"/>, <include refid="unitColumn"/>,<include refid="categoryColumn"/>
		from t_whs_goods t1
		left join t_whs_goods_unit t2 on t1.base_unit = t2.id
		left join t_whs_goods_category t3 on t1.category_id = t3.id
		where t1.category_id in 
		<foreach collection="list" item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
	</select>
</mapper>