<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lhiot.mall.wholesale.demand.mapper.DemandGoodsMapper">
	<sql id="demandGoodsColumn">
		t1.id as id,t1.goods_brand as goodsBrand,t1.goods_name as goodsName,t1.goods_standard as goodsStandard,
		t1.reference_price as referencePrice,t1.supplier as supplier,t1.comments as comments,t1.contact_phone as contactPhone,
		t1.user_id as userId,DATE_FORMAT(t1.create_time,'%Y-%m-%d %H:%i:%s') as createTime
	</sql>

	<sql id="userColumn">
		t2.shop_name as shopName,t2.user_name as userName,t2.city as city,t2.address_detail as addressDetail,t2.register_time as registerTime
	</sql>

	<insert id="insert" parameterType="com.lhiot.mall.wholesale.demand.domain.DemandGoods" useGeneratedKeys="true">
		INSERT INTO t_whs_demand_goods (id, goods_name, goods_brand, goods_standard, supplier, reference_price, comments, contact_way, create_time, user_id)
		VALUES (#{id}, #{goodsName}, #{goodsBrand}, #{goodsStandard}, #{supplier}, #{referencePrice}, #{comments}, #{contactWay}, #{cereate_time}, #{userId})
	</insert>

	<delete id="remove" parameterType="long">
		DELETE FROM t_whs_demand_goods WHERE id = #{0}
	</delete>


	<update id="update" parameterType="com.lhiot.mall.wholesale.demand.domain.DemandGoods">
		UPDATE t_whs_demand_goods set id = #{id}
		<if test="goodsName != null and goodsName != ''">
			,goods_name = #{goodsName}
		</if>
		<if test="userId != 0">
			,user_id = #{userId}
		</if>
		WHERE id = #{id}
	</update>

	<select id="select" parameterType="long" resultType="com.lhiot.mall.wholesale.demand.domain.DemandGoods">
		SELECT <include refid="demandGoodsColumn"/>
		FROM t_whs_demand_goods t1
		WHERE t1.id = #{0}
	</select>

	<select id="search" parameterType="java.util.List" resultType="com.lhiot.mall.wholesale.demand.domain.DemandGoods">
		SELECT <include refid="demandGoodsColumn"/>
		FROM t_whs_demand_goods t1		
		WHERE 1 = 1
		<if test="userName != null and userName != ''">
			AND user_id IN
			<foreach collection="list" item="item" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
	</select>

	<!-- lynn后台管理 分页查询2018/4/19 -->
	<select id="pageQueryCount" parameterType="com.lhiot.mall.wholesale.demand.domain.gridparam.DemandGoodsGridParam" resultType="Integer">
		select count(t1.id) from t_whs_demand_goods t1
		left join t_whs_user t2 on t1.user_id = t2.id
		<trim prefix="where" prefixOverrides="and">
			<if test="createTimeBegin != null and createTimeBegin != ''">and t1.create_time &gt;= #{createTimeBegin}</if>
			<if test="createTimeEnd != null and createTimeEnd != ''">and t1.create_time &lt;= #{createTimeEnd}</if>
			<if test="namePhone != null and namePhone != ''">and t2.user_name like CONCAT('%',#{namePhone},'%') or t2.phone like CONCAT('%',#{namePhone},'%')</if>
		</trim>
	</select>

	<!-- lynn后台管理 分页查询2018/4/19 -->
	<select id="pageQuery" parameterType="com.lhiot.mall.wholesale.demand.domain.gridparam.DemandGoodsGridParam"
			resultType="com.lhiot.mall.wholesale.demand.domain.DemandGoodsResult">
		select <include refid="demandGoodsColumn"/>
		from t_whs_demand_goods t1
		WHERE 1=1
			<if test="createTimeBegin != null and createTimeBegin != ''">and t1.create_time &gt;= #{createTimeBegin}</if>
			<if test="createTimeEnd != null and createTimeEnd != ''">and t1.create_time &lt;= #{createTimeEnd}</if>
			<if test="userIds != null and userIds != ''">
				and t1.user_id in
				<foreach collection="setUserIds" item="userId" open="(" separator="," close=")">
					#{userId}
				</foreach>
			</if>
		<include refid="common.pager"></include>
	</select>


</mapper>
